<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>One World One Centre — Intake Wizard & Yellow Form (Final)</title>

<!-- html2pdf for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
  :root{--max-w:1100px}
  body{font-family: Arial, Helvetica, sans-serif;background:#f3f4f6;margin:0;padding:18px;color:#111}
  .app{max-width:var(--max-w);margin:0 auto}
  h1{font-size:18px;margin-bottom:12px}
  /* Wizard */
  .page{display:none;background:white;border:1px solid #e6e7ea;padding:16px;border-radius:6px;margin-bottom:12px}
  .page.active{display:block}
  .controls{display:flex;justify-content:space-between;gap:10px;margin-top:12px}
  .btn{background:#0f5132;color:white;padding:10px 14px;border:0;border-radius:6px;cursor:pointer}
  .btn.secondary{background:#475569}
  .row{display:flex;gap:12px;margin-bottom:10px;flex-wrap:wrap}
  .col{flex:1;min-width:120px}
  label{display:block;font-size:13px;margin-bottom:6px}
  input[type=text], input[type=date], textarea, select{width:100%;padding:8px;border:1px solid #cbd5e1;border-radius:4px;font-size:14px}
  textarea{min-height:80px}
  .disabled-input{background:#f3f4f6;color:#6b7280}
  .student-block{border-top:1px dashed #e5e7eb;padding-top:10px;margin-top:10px}
  /* Final yellow replica (fits one screen and responsive) */
  .final-wrap{display:none;margin-top:14px}
  .yellow-sheet{background:#FFF9C4;border:2px solid #000;padding:12px;border-radius:2px}
  .replica-table{width:100%;border-collapse:collapse;font-size:13px}
  .replica-table td, .replica-table th{border:1px solid #000;padding:6px;vertical-align:top}
  .label-bold{font-weight:700;font-size:12px}
  .muted{color:#6b7280}
  .chk{display:inline-block;width:20px;text-align:center;font-weight:700;margin-right:6px}
  .header-img{width:100%;max-height:70px;object-fit:contain;margin-bottom:6px}
  @media (max-width:720px){
    .row{flex-direction:column}
    .header-img{max-height:56px}
    .replica-table td, .replica-table th{font-size:12px;padding:5px}
  }
</style>
</head>
<body>
  <div class="app">
    <h1>INFORMATION NEEDED FOR BOOKING APPOINTMENTS — Wizard</h1>

    <div id="wizardRoot">
      <!-- PAGE 1 -->
      <section class="page active" data-step="1" id="page-1">
        <h3>Step 1 — Contact & Intake</h3>
        <div class="row">
          <div class="col" style="flex:0.9"><label>DATE</label><input id="date" type="date" /></div>
          <div class="col" style="flex:1.4"><label>TAKEN BY</label><input id="takenBy" type="text" placeholder="Name" /></div>
          <div class="col" style="flex:2"><label>CONTACT NAME/SURNAME</label><input id="contactName" type="text" /></div>
          <div class="col" style="flex:1"><label>CONTACT PHONE #</label><input id="contactPhone" type="text" /></div>
          <div class="col" style="flex:0.9"><label>CONTACT RELATIONSHIP</label><input id="contactRel" type="text" /></div>
        </div>
        <div class="controls no-print">
          <div></div>
          <div><button class="btn" onclick="goTo(2)">Next</button></div>
        </div>
      </section>

      <!-- PAGE 2 -->
      <section class="page" data-step="2" id="page-2">
        <h3>Step 2 — Immigration & Attendance</h3>
        <div class="row">
          <div class="col" style="flex:1.6">
            <label>STUDENT'S STATUS</label>
            <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center">
              <label><input type="radio" name="studentStatus" value="PR"> PR</label>
              <label><input type="radio" name="studentStatus" value="RC"> RC</label>
              <label><input type="radio" name="studentStatus" value="SP"> SP</label>
              <label><input type="radio" name="studentStatus" value="WP"> WP</label>
              <label><input type="radio" name="studentStatus" value="Other" onchange="toggleOtherField('studentStatusOther', this)"> Other</label>
              <input id="studentStatusOther" class="hidden" type="text" placeholder="Specify" style="margin-left:6px;padding:6px;border:1px solid #cbd5e1;border-radius:4px" />
            </div>
          </div>

          <div class="col" style="flex:2">
            <label>IMMIGRATION DOCUMENT (OF NATURAL PARENT/GUARDIAN)</label>
            <div style="display:flex;flex-wrap:wrap;gap:10px;align-items:center">
              <label><input type="radio" name="immDoc" value="PR"> PR</label>
              <label><input type="radio" name="immDoc" value="RC"> RC</label>
              <label><input type="radio" name="immDoc" value="SP"> SP</label>
              <label><input type="radio" name="immDoc" value="WP"> WP</label>
              <label><input type="radio" name="immDoc" value="Other" onchange="toggleOtherField('immDocOther', this)"> Other</label>
              <input id="immDocOther" class="hidden" type="text" placeholder="Specify" style="margin-left:6px;padding:6px;border:1px solid #cbd5e1;border-radius:4px" />
            </div>
          </div>

          <div class="col" style="flex:1"><label>EXPIRY DATE (RC/SP/WP)</label><input id="expiry" type="date" /></div>
        </div>

        <div class="row" style="align-items:flex-start">
          <div class="col" style="flex:1">
            <label>PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?</label>
            <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
              <label><input type="radio" name="prevAttend" value="No" onchange="toggleAttendance(false)"> No</label>
              <label><input type="radio" name="prevAttend" value="Yes" onchange="toggleAttendance(true)"> Yes</label>
            </div>
          </div>
          <div class="col" style="flex:3">
            <label>IF YES: WHERE/GRADE/FOR HOW LONG</label>
            <input id="prevDetails" type="text" class="disabled-input" placeholder="If Yes: Where / Grade / For how long" disabled />
          </div>
        </div>

        <div class="row">
          <div class="col" style="flex:1"><label>DATE STUDENT(S) LANDED IN CANADA</label><input id="landed" type="date" /></div>
        </div>

        <div class="controls no-print">
          <button class="btn secondary" onclick="goTo(1)">Back</button>
          <button class="btn" onclick="goTo(3)">Next</button>
        </div>
      </section>

      <!-- PAGE 3 -->
      <section class="page" data-step="3" id="page-3">
        <h3>Step 3 — Parent / Guardian</h3>
        <div class="row">
          <div class="col"><label>FATHER'S SURNAME</label><input id="fatherSurname" type="text" /></div>
          <div class="col"><label>FATHER'S GIVEN NAME</label><input id="fatherGiven" type="text" /></div>
          <div class="col"><label>MOTHER'S SURNAME</label><input id="motherSurname" type="text" /></div>
          <div class="col"><label>MOTHER'S GIVEN NAME</label><input id="motherGiven" type="text" /></div>
        </div>
        <div class="controls no-print">
          <button class="btn secondary" onclick="goTo(2)">Back</button>
          <button class="btn" onclick="goTo(4)">Next</button>
        </div>
      </section>

      <!-- PAGE 4 -->
      <section class="page" data-step="4" id="page-4">
        <h3>Step 4 — Address & Family</h3>
        <div class="row">
          <div class="col" style="flex:0.7"><label>APARTMENT #</label><input id="apt" type="text" /></div>
          <div class="col" style="flex:3"><label>FAMILY ADDRESS</label><input id="address" type="text" /></div>
          <div class="col" style="flex:1"><label>POSTAL CODE</label><input id="postal" type="text" /></div>
        </div>

        <div class="row">
          <div class="col"><label>FAMILY PHONE #</label><input id="familyPhone" type="text" /></div>
          <div class="col"><label>HOME LANGUAGE</label><input id="homeLang" type="text" /></div>
          <div class="col" style="flex:1"><label>CATHOLIC</label>
            <div style="display:flex;gap:12px;margin-top:6px">
              <label><input type="radio" name="catholic" value="No"> No</label>
              <label><input type="radio" name="catholic" value="Yes"> Yes</label>
            </div>
          </div>
        </div>

        <div class="controls no-print">
          <button class="btn secondary" onclick="goTo(3)">Back</button>
          <button class="btn" onclick="goTo(5)">Next</button>
        </div>
      </section>

      <!-- PAGE 5 (Students dynamic) -->
      <section class="page" data-step="5" id="page-5">
        <h3>Step 5 — Student Details (Add as many as needed)</h3>
        <div id="studentsContainer"></div>

        <div style="margin-top:8px;display:flex;gap:8px">
          <button class="btn" onclick="addStudent()">Add Student</button>
          <button class="btn secondary" onclick="removeStudent()">Remove Last</button>
        </div>

        <div class="controls no-print">
          <button class="btn secondary" onclick="goTo(4)">Back</button>
          <button class="btn" onclick="goTo(6)">Next</button>
        </div>
      </section>

      <!-- PAGE 6 -->
      <section class="page" data-step="6" id="page-6">
        <h3>Step 6 — Schooling profile & notes</h3>
        <div class="row">
          <div class="col" style="flex:1.5">
            <label>POTENTIAL LIMITED FORMAL SCHOOLING PROFILE</label>
            <div style="display:flex;gap:12px;margin-top:6px">
              <label><input type="radio" name="limitedProfile" value="No"> No</label>
              <label><input type="radio" name="limitedProfile" value="Yes"> Yes</label>
            </div>
          </div>
          <div class="col" style="flex:3">
            <label>DETAILS (Number of years as refugees, country of relocation, refugee camp name, nature of schooling, parent country of origin)</label>
            <textarea id="notes"></textarea>
          </div>
        </div>

        <div class="controls no-print">
          <button class="btn secondary" onclick="goTo(5)">Back</button>
          <button class="btn" onclick="generateFinal()">Generate Yellow Form</button>
        </div>
      </section>
    </div>

    <!-- FINAL STATIC YELLOW FORM (replica) -->
    <div id="finalWrap" class="final-wrap">
      <div class="yellow-sheet" id="finalArea">
        <!-- Header image will be inserted here -->
      </div>

      <div style="margin-top:10px;display:flex;gap:10px">
        <button id="printBtn" class="btn" onclick="window.print()">Print</button>
        <button id="pdfBtn" class="btn secondary">Download PDF</button>
        <button id="editBtn" class="btn secondary">Back to Edit</button>
      </div>
    </div>

  </div>

<script>
  // Navigation
  function goTo(step){
    document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    const target = document.querySelector(`.page[data-step='${step}']`);
    if(target){ target.classList.remove('hidden'); target.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}) }
  }
  // toggle other fields
  function toggleOtherField(id, el){
    const inp = document.getElementById(id);
    if(el.checked && el.value==='Other'){ inp.classList.remove('hidden'); inp.focus() } else { inp.classList.add('hidden'); inp.value = '' }
  }
  // attendance toggle
  function toggleAttendance(isYes){
    const d = document.getElementById('prevDetails');
    if(isYes){ d.disabled = false; d.classList.remove('disabled-input') } else { d.disabled = true; d.classList.add('disabled-input'); d.value = '' }
  }

  // Dynamic students
  let studentCount = 0;
  function addStudent(prefill){
    studentCount++;
    const id = studentCount;
    const container = document.getElementById('studentsContainer');
    const wrap = document.createElement('div');
    wrap.className = 'student-block';
    wrap.id = `student-${id}`;
    wrap.innerHTML = `
      <div class="row">
        <div class="col" style="flex:2"><label>STUDENT'S SURNAME</label><input type="text" id="s_${id}_surname" value="${prefill?.surname||''}" /></div>
        <div class="col" style="flex:2"><label>STUDENT'S GIVEN NAME</label><input type="text" id="s_${id}_given" value="${prefill?.given||''}" /></div>
        <div class="col" style="flex:1"><label>GENDER</label>
          <div style="display:flex;gap:8px;margin-top:6px">
            <label><input type="radio" name="s_${id}_gender" value="F"> F</label>
            <label><input type="radio" name="s_${id}_gender" value="M"> M</label>
          </div>
        </div>
        <div class="col" style="flex:1"><label>DOB</label><input type="date" id="s_${id}_dob" value="${prefill?.dob||''}" /></div>
        <div class="col" style="flex:2"><label>BIRTH COUNTRY</label><input type="text" id="s_${id}_birth" value="${prefill?.birth||''}" /></div>
      </div>

      <div class="row" style="margin-top:8px">
        <div class="col" style="flex:2"><label>LAST GRADE COMPLETED</label><input type="text" id="s_${id}_lastgrade" value="${prefill?.lastgrade||''}" /></div>
        <div class="col" style="flex:2"><label>SCHOOL YEAR</label>
          <div style="display:flex;gap:8px;margin-top:6px">
            <label><input type="radio" name="s_${id}_year" value="ThisYear"> THIS YEAR</label>
            <label><input type="radio" name="s_${id}_year" value="NextYear"> NEXT YEAR</label>
          </div>
        </div>
        <div class="col" style="flex:2"><label>PROGRAM</label>
          <div style="display:flex;gap:8px;margin-top:6px">
            <label><input type="radio" name="s_${id}_prog" value="No"> NO</label>
            <label><input type="radio" name="s_${id}_prog" value="Yes"> YES</label>
            <input type="text" id="s_${id}_prog_spec" placeholder="Specify" style="margin-left:8px;padding:6px;border:1px solid #cbd5e1;border-radius:4px" />
          </div>
        </div>
      </div>
    `;
    container.appendChild(wrap);
    window.scrollTo({top:wrap.offsetTop-80,behavior:'smooth'});
  }
  function removeStudent(){ if(studentCount===0) return; const el=document.getElementById(`student-${studentCount}`); if(el) el.remove(); studentCount-- }

  // start with one student
  addStudent();

  // helper functions
  function checkboxMark(cond){ return cond ? '☑' : '☐' }
  function getRadioValue(name){ const r = document.querySelector(`input[name='${name}']:checked`); return r? r.value : '' }

  // generate final yellow replica
  function generateFinal(){
    const final = document.getElementById('finalArea');
    final.innerHTML = ''; // clear

    // add header image (expects header.png in same folder)
    const img = document.createElement('img');
    img.src = 'header.png';
    img.alt = 'Header';
    img.className = 'header-img';
    final.appendChild(img);

    // build table replica - mirror photo order/labels
    const tbl = document.createElement('table');
    tbl.className = 'replica-table';

    function addRow(label, col1, label2, col2, muted){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="label-bold" style="width:22%">${label}</td>
        <td ${muted? 'class="muted"':''} style="width:28%">${col1||''}</td>
        <td class="label-bold" style="width:22%">${label2||''}</td>
        <td ${muted? 'class="muted"':''} style="width:28%">${col2||''}</td>
      `;
      tbl.appendChild(tr);
    }

    // Top rows
    addRow('DATE', document.getElementById('date').value, 'TAKEN BY', document.getElementById('takenBy').value);
    addRow('CONTACT NAME/SURNAME', document.getElementById('contactName').value, 'CONTACT PHONE #', document.getElementById('contactPhone').value);
    addRow('CONTACT RELATIONSHIP', document.getElementById('contactRel').value, '', '');

    // immigration & student status
    const sStatus = getRadioValue('studentStatus');
    const sStatusOther = document.getElementById('studentStatusOther').value;
    const statusText = sStatus === 'Other' ? sStatusOther : (sStatus || '');
    const imm = getRadioValue('immDoc');
    const immOther = document.getElementById('immDocOther').value;
    const immText = imm === 'Other' ? immOther : (imm || '');
    addRow("STUDENT'S STATUS", statusText, 'IMMIGRATION DOCUMENT (OF NATURAL PARENT/GUARDIAN)', immText);

    addRow('EXPIRY DATE (RC/SP/WP)', document.getElementById('expiry').value,
           'PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?', (function(){
             const val = getRadioValue('prevAttend');
             if(val==='Yes') return checkboxMark(true)+' Yes';
             if(val==='No') return checkboxMark(true)+' No';
             return '';
           })() );

    // previous details (gray out if disabled)
    const prevDetails = document.getElementById('prevDetails');
    const prevMuted = prevDetails.disabled;
    addRow('DATE STUDENT(S) LANDED IN CANADA', document.getElementById('landed').value, 'IF YES: WHERE/GRADE/FOR HOW LONG', `<span class="${prevMuted? 'muted':''}">${prevDetails.value || (prevMuted? '—':'')}</span>`, prevMuted);

    addRow("FATHER'S SURNAME", document.getElementById('fatherSurname').value, "FATHER'S GIVEN NAME", document.getElementById('fatherGiven').value);
    addRow("MOTHER'S SURNAME", document.getElementById('motherSurname').value, "MOTHER'S GIVEN NAME", document.getElementById('motherGiven').value);

    addRow('APARTMENT #', document.getElementById('apt').value, 'FAMILY ADDRESS', document.getElementById('address').value + (document.getElementById('postal').value ? ' / '+document.getElementById('postal').value : ''));

    const cath = getRadioValue('catholic');
    const cathDisplay = cath ? (checkboxMark(cath==='Yes')+' Yes   '+checkboxMark(cath==='No')+' No') : '';
    addRow('FAMILY PHONE #', document.getElementById('familyPhone').value, 'HOME LANGUAGE', document.getElementById('homeLang').value + '  ' + cathDisplay);

    // students header
    const headerRow = document.createElement('tr');
    headerRow.innerHTML = `<td class="label-bold">STUDENT(S)</td><td colspan="3"></td>`;
    tbl.appendChild(headerRow);

    for(let i=1;i<=studentCount;i++){
      const surname = document.getElementById(`s_${i}_surname`)? document.getElementById(`s_${i}_surname`).value : '';
      const given = document.getElementById(`s_${i}_given`)? document.getElementById(`s_${i}_given`).value : '';
      const gender = (function(){ const g = document.querySelector(`input[name='s_${i}_gender']:checked`); return g? g.value : '' })();
      const dob = document.getElementById(`s_${i}_dob`)? document.getElementById(`s_${i}_dob`).value : '';
      const birth = document.getElementById(`s_${i}_birth`)? document.getElementById(`s_${i}_birth`).value : '';
      const last = document.getElementById(`s_${i}_lastgrade`)? document.getElementById(`s_${i}_lastgrade`).value : '';
      const year = (function(){ const y = document.querySelector(`input[name='s_${i}_year']:checked`); return y? y.value : '' })();
      const prog = (function(){ const p = document.querySelector(`input[name='s_${i}_prog']:checked`); return p? p.value : '' })();
      const progSpec = document.getElementById(`s_${i}_prog_spec`)? document.getElementById(`s_${i}_prog_spec`).value : '';

      if(surname || given || birth || last){
        addRow("STUDENT'S SURNAME", surname, "STUDENT'S GIVEN NAME", given);
        addRow('GENDER / DOB', `${checkboxMark(gender==='F')} F ${checkboxMark(gender==='M')} M  / ${dob}`, 'BIRTH COUNTRY', birth);
        addRow('LAST GRADE COMPLETED', last, 'SCHOOL YEAR / PROGRAM', `${year? (year==='ThisYear'?'This year':'Next year') : ''} / ${prog? (prog + (progSpec? ' — '+progSpec:'')) : ''}`);
      }
    }

    const limited = getRadioValue('limitedProfile');
    const notes = document.getElementById('notes').value;
    addRow('POTENTIAL LIMITED FORMAL SCHOOLING PROFILE', limited? (checkboxMark(limited==='Yes')+' Yes') : '', 'NOTES', notes || '');

    // append table and show
    final.appendChild(tbl);

    document.getElementById('wizardRoot').style.display = 'none';
    document.getElementById('finalWrap').style.display = 'block';
    window.scrollTo({top:0,behavior:'smooth'});

    // PDF button
    document.getElementById('pdfBtn').onclick = ()=>{
      const element = document.getElementById('finalArea');
      // html2pdf options - keep yellow background & header
      const opt = {
        margin: 0.2,
        filename: 'one-world-one-centre-intake.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, backgroundColor: null },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    };

    document.getElementById('editBtn').onclick = ()=>{
      document.getElementById('wizardRoot').style.display = 'block';
      document.getElementById('finalWrap').style.display = 'none';
      window.scrollTo({top:0,behavior:'smooth'});
    };
  }
</script>
</body>
</html>
