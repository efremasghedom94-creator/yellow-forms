<script>
function generateFinal() {
  const final = document.getElementById('finalArea');

  final.innerHTML = `
    <div class="text-center mb-3 font-bold text-lg">
      INFORMATION NEEDED FOR BOOKING APPOINTMENTS
    </div>
    <table class="w-full border border-black text-xs yellow-bg">
      <tr>
        <td class="border p-1 w-28">DATE</td>
        <td class="border p-1">${document.getElementById('date').value}</td>
        <td class="border p-1 w-32">TAKEN BY</td>
        <td class="border p-1">${document.getElementById('takenBy').value}</td>
      </tr>
      <tr>
        <td class="border p-1">CONTACT NAME</td>
        <td class="border p-1">${document.getElementById('contactName').value}</td>
        <td class="border p-1">CONTACT PHONE #</td>
        <td class="border p-1">${document.getElementById('contactPhone').value}</td>
      </tr>
      <tr>
        <td class="border p-1">CONTACT RELATIONSHIP</td>
        <td class="border p-1">${document.getElementById('contactRel').value}</td>
        <td class="border p-1">DATE STUDENT(S) LANDED IN CANADA</td>
        <td class="border p-1">${document.getElementById('landed').value}</td>
      </tr>
    </table>

    <table class="w-full border border-black text-xs yellow-bg mt-2">
      <tr>
        <td class="border p-1 w-32">STUDENT'S STATUS</td>
        <td class="border p-1">${document.querySelector("input[name='studentStatus']:checked")?.value || ''}</td>
        <td class="border p-1 w-48">IMMIGRATION DOCUMENT (OF NATURAL PARENT/GUARDIAN)</td>
        <td class="border p-1">${document.querySelector("input[name='immDoc']:checked")?.value || ''}</td>
        <td class="border p-1 w-32">EXPIRY DATE</td>
        <td class="border p-1">${document.getElementById('expiry').value}</td>
      </tr>
      <tr>
        <td class="border p-1">PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?</td>
        <td class="border p-1" colspan="5">${document.querySelector("input[name='prevAttend']:checked")?.value || ''} ${document.getElementById('prevDetails')?.value || ''}</td>
      </tr>
    </table>

    <table class="w-full border border-black text-xs yellow-bg mt-2">
      <tr>
        <td class="border p-1 w-32">FATHER'S SURNAME</td>
        <td class="border p-1">${document.getElementById('fatherSurname').value}</td>
        <td class="border p-1 w-32">FATHER'S GIVEN NAME</td>
        <td class="border p-1">${document.getElementById('fatherGiven').value}</td>
      </tr>
      <tr>
        <td class="border p-1">MOTHER'S SURNAME</td>
        <td class="border p-1">${document.getElementById('motherSurname').value}</td>
        <td class="border p-1">MOTHER'S GIVEN NAME</td>
        <td class="border p-1">${document.getElementById('motherGiven').value}</td>
      </tr>
    </table>

    <table class="w-full border border-black text-xs yellow-bg mt-2">
      <tr>
        <td class="border p-1 w-24">APARTMENT #</td>
        <td class="border p-1">${document.getElementById('apt').value}</td>
        <td class="border p-1 w-32">FAMILY ADDRESS</td>
        <td class="border p-1">${document.getElementById('address').value}</td>
        <td class="border p-1 w-24">POSTAL CODE</td>
        <td class="border p-1">${document.getElementById('postal').value}</td>
      </tr>
      <tr>
        <td class="border p-1">FAMILY PHONE #</td>
        <td class="border p-1">${document.getElementById('familyPhone').value}</td>
        <td class="border p-1">HOME LANGUAGE</td>
        <td class="border p-1">${document.getElementById('homeLang').value}</td>
        <td class="border p-1">CATHOLIC</td>
        <td class="border p-1">${document.querySelector("input[name='catholic']:checked")?.value || ''}</td>
      </tr>
    </table>

    <div class="mt-2 text-xs yellow-bg border border-black">
      ${Array.from({length: studentCount}, (_, i) => {
        const idx = i + 1;
        return `
          <div class="grid grid-cols-12 border-b border-black">
            <div class="col-span-2 border-r p-1">${document.getElementById("s_"+idx+"_surname")?.value || ''}</div>
            <div class="col-span-2 border-r p-1">${document.getElementById("s_"+idx+"_given")?.value || ''}</div>
            <div class="col-span-1 border-r p-1">${document.querySelector("input[name='s_"+idx+"_gender']:checked")?.value || ''}</div>
            <div class="col-span-2 border-r p-1">${document.getElementById("s_"+idx+"_dob")?.value || ''}</div>
            <div class="col-span-2 border-r p-1">${document.getElementById("s_"+idx+"_birth")?.value || ''}</div>
            <div class="col-span-3 p-1">Last Grade/School Year/Program (to be filled)</div>
          </div>
        `;
      }).join("")}
    </div>

    <div class="mt-2 border border-black p-2 yellow-bg text-xs">
      <strong>POTENTIAL LIMITED FORMAL SCHOOLING PROFILE:</strong><br>
      ${document.querySelector("input[name='limitedSchooling']:checked")?.value || ''}<br>
      Notes: ${document.getElementById('notes').value}
    </div>

    <div class="mt-2 text-xs muted">Rev. 2021</div>
  `;

  document.getElementById('wizardRoot').classList.add('hidden');
  document.getElementById('finalWrap').classList.remove('hidden');
}
</script>
