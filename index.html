<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>One World One Centre — Intake Wizard & Yellow Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    .field-gap{gap:12px}
    .disabled-input{background:#f3f4f6;color:#6b7280}
    .yellow-bg{background:#FFF9C4}
    .checkbox-box{display:inline-block;width:20px;height:20px;border:1px solid #111;text-align:center;line-height:18px;font-weight:700;margin-right:6px}
    .muted{color:#6b7280}
    @media print{
      body{margin:0}
      .wizard{display:none}
      .final-wrap{display:block}
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-6">
    <div id="wizardRoot" class="wizard bg-white rounded-lg shadow p-6">
      <h1 class="text-xl font-semibold mb-4">INFORMATION NEEDED FOR BOOKING APPOINTMENTS — Wizard</h1>
      <!-- steps 1–6 exactly as in your original (unchanged) -->
      <!-- ... (same code you pasted for pages 1–6) ... -->
    </div>

    <!-- FINAL STATIC YELLOW FORM -->
    <div id="finalWrap" class="final-wrap hidden mt-6">
      <div id="finalArea" class="yellow-bg p-6 rounded shadow border"></div>
      <div class="mt-4 flex gap-3">
        <button id="printBtn" class="px-4 py-2 bg-blue-600 text-white rounded" onclick="window.print()">Print</button>
        <button id="pdfBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">Download PDF</button>
        <button id="editBtn" class="px-4 py-2 bg-gray-500 text-white rounded">Back to Edit</button>
      </div>
    </div>
  </div>

  <script>
    function goTo(step){
      document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'))
      const target=document.querySelector(`.page[data-step='${step}']`)
      if(target) target.classList.remove('hidden')
      window.scrollTo({top:0,behavior:'smooth'})
    }

    function toggleOtherField(id,el){
      const inp=document.getElementById(id)
      if(el.value==='Other' && el.checked){inp.classList.remove('hidden');inp.focus()}else{inp.classList.add('hidden');inp.value=''}
    }

    function toggleAttendance(isYes){
      const d=document.getElementById('prevDetails')
      if(isYes){d.disabled=false;d.classList.remove('disabled-input')}else{d.disabled=true;d.classList.add('disabled-input');d.value=''}
    }

    let studentCount=0
    function addStudent(prefill){
      studentCount++
      const id=studentCount
      const container=document.getElementById('studentsContainer')
      const wrap=document.createElement('div')
      wrap.className='p-4 border rounded bg-gray-50'
      wrap.id=`student-${id}`
      wrap.innerHTML=`
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-3"><label class="text-sm">STUDENT'S SURNAME</label><input type="text" id="s_${id}_surname" class="w-full border rounded p-2 mt-1" value="${prefill?.surname||''}" /></div>
          <div class="col-span-3"><label class="text-sm">STUDENT'S GIVEN NAME</label><input type="text" id="s_${id}_given" class="w-full border rounded p-2 mt-1" value="${prefill?.given||''}" /></div>
          <div class="col-span-2"><label class="text-sm">GENDER</label><div class="mt-1 flex items-center gap-3"><label class="inline-flex items-center"><input type="radio" name="s_${id}_gender" value="F" class="mr-2">F</label><label class="inline-flex items-center"><input type="radio" name="s_${id}_gender" value="M" class="mr-2">M</label></div></div>
          <div class="col-span-2"><label class="text-sm">DOB</label><input type="date" id="s_${id}_dob" class="w-full border rounded p-2 mt-1" value="${prefill?.dob||''}" /></div>
          <div class="col-span-2"><label class="text-sm">BIRTH COUNTRY</label><input type="text" id="s_${id}_birth" class="w-full border rounded p-2 mt-1" value="${prefill?.birth||''}" /></div>
          <div class="col-span-4 mt-2"><label class="text-sm">LAST GRADE COMPLETED</label><input type="text" id="s_${id}_lastgrade" class="w-full border rounded p-2 mt-1" value="${prefill?.lastgrade||''}" /></div>
          <div class="col-span-4 mt-2"><label class="text-sm">SCHOOL YEAR</label><div class="mt-1 flex items-center gap-3"><label class="inline-flex items-center"><input type="radio" name="s_${id}_year" value="ThisYear" class="mr-2">This year</label><label class="inline-flex items-center"><input type="radio" name="s_${id}_year" value="NextYear" class="mr-2">Next year</label></div></div>
          <div class="col-span-4 mt-2"><label class="text-sm">PROGRAM</label><div class="mt-1 flex items-center gap-3"><label class="inline-flex items-center"><input type="radio" name="s_${id}_prog" value="No" class="mr-2">No</label><label class="inline-flex items-center"><input type="radio" name="s_${id}_prog" value="Yes" class="mr-2">Yes</label><input type="text" id="s_${id}_prog_spec" class="border rounded p-2 ml-2" placeholder="Specify (if Yes)" /></div></div>
        </div>`
      container.appendChild(wrap)
      window.scrollTo({top:wrap.offsetTop-60,behavior:'smooth'})
    }
    function removeStudent(){if(studentCount===0)return;const el=document.getElementById(`student-${studentCount}`);if(el)el.remove();studentCount--}
    addStudent()

    function checkboxMark(cond){return cond? '☑':'☐'}
    function getRadioValue(name){const r=document.querySelector(`input[name='${name}']:checked`);return r? r.value:''}

    function generateFinal(){
      const final=document.getElementById('finalArea')
      final.innerHTML=''
      const tbl=document.createElement('table')
      tbl.className='w-full border-collapse'

      function addRow(label,col1,label2,col2,mutedCol1){
        const tr=document.createElement('tr')
        tr.innerHTML=`
          <td class="p-2 border font-semibold w-40">${label}</td>
          <td class="p-2 border ${mutedCol1?'muted':''}">${col1||''}</td>
          <td class="p-2 border font-semibold w-40">${label2||''}</td>
          <td class="p-2 border">${col2||''}</td>`
        tbl.appendChild(tr)
      }

      addRow('DATE',document.getElementById('date').value,'TAKEN BY',document.getElementById('takenBy').value)
      addRow('CONTACT NAME/SURNAME',document.getElementById('contactName').value,'CONTACT PHONE #',document.getElementById('contactPhone').value)
      addRow('CONTACT RELATIONSHIP',document.getElementById('contactRel').value,'','')

      const sStatus=getRadioValue('studentStatus')
      const sStatusOther=document.getElementById('studentStatusOther').value
      const imm=getRadioValue('immDoc')
      const immOther=document.getElementById('immDocOther').value
      const statusText=sStatus==='Other'? sStatusOther:(sStatus||'')
      const immText=imm==='Other'? immOther:(imm||'')
      addRow("STUDENT'S STATUS",statusText,'IMMIGRATION DOCUMENT (OF NATURAL PARENT/GUARDIAN)',immText)

      addRow('EXPIRY DATE (RC/SP/WP)',document.getElementById('expiry').value,'PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?',(()=>{
        const val=getRadioValue('prevAttend')
        if(val==='Yes') return checkboxMark(true)+' Yes'
        if(val==='No') return checkboxMark(true)+' No'
        return ''
      })())

      const prevDetails=document.getElementById('prevDetails')
      const prevShown=prevDetails.value
      const prevMuted=prevDetails.disabled
      addRow('DATE STUDENT(S) LANDED IN CANADA',document.getElementById('landed').value,'PREVIOUS DETAILS',`<span class="${prevMuted?'muted':''}">${prevShown||(prevMuted?'—':'')}</span>`,prevMuted)

      addRow("FATHER'S SURNAME",document.getElementById('fatherSurname').value,"FATHER'S GIVEN NAME",document.getElementById('fatherGiven').value)
      addRow("MOTHER'S SURNAME",document.getElementById('motherSurname').value,"MOTHER'S GIVEN NAME",document.getElementById('motherGiven').value)

      addRow('APARTMENT #',document.getElementById('apt').value,'FAMILY ADDRESS',document.getElementById('address').value+(document.getElementById('postal').value? ' / '+document.getElementById('postal').value:''))
      addRow('FAMILY PHONE #',document.getElementById('familyPhone').value,'HOME LANGUAGE',document.getElementById('homeLang').value+'  '+(()=>{const c=getRadioValue('catholic');return c? (checkboxMark(c==='Yes')+' Yes   '+checkboxMark(c==='No')+' No'):''})())

      const header=document.createElement('tr')
      header.innerHTML=`<td class="p-2 border font-semibold">STUDENT(S)</td><td class="p-2 border" colspan="3"></td>`
      tbl.appendChild(header)

      for(let i=1;i<=studentCount;i++){
        const surname=document.getElementById(`s_${i}_surname`)?.value||''
        const given=document.getElementById(`s_${i}_given`)?.value||''
        const gender=(()=>{const g=document.querySelector(`input[name='s_${i}_gender']:checked`);return g? g.value:''})()
        const dob=document.getElementById(`s_${i}_dob`)?.value||''
        const birth=document.getElementById(`s_${i}_birth`)?.value||''
        const last=document.getElementById(`s_${i}_lastgrade`)?.value||''
        const year=(()=>{const y=document.querySelector(`input[name='s_${i}_year']:checked`);return y? y.value:''})()
        const prog=(()=>{const p=document.querySelector(`input[name='s_${i}_prog']:checked`);return p? p.value:''})()
        const progSpec=document.getElementById(`s_${i}_prog_spec`)?.value||''
        if(surname||given||birth||last){
          addRow("STUDENT'S SURNAME",surname,"STUDENT'S GIVEN NAME",given)
          addRow('GENDER / DOB',`${checkboxMark(gender==='F')} F ${checkboxMark(gender==='M')} M  / ${dob}`,'BIRTH COUNTRY',birth)
          addRow('LAST GRADE COMPLETED',last,'SCHOOL YEAR / PROGRAM',`${year? year.replace('ThisYear','This year').replace('NextYear','Next year'):''} / ${prog? (prog+(progSpec? ' — '+progSpec:'')):''}`)
        }
      }

      const limited=getRadioValue('limitedProfile')
      const notes=document.getElementById('notes').value
      addRow('POTENTIAL LIMITED FORMAL SCHOOLING PROFILE',limited? (checkboxMark(limited==='Yes')+' Yes'):'','NOTES',notes||'')

      final.appendChild(tbl)
      document.getElementById('wizardRoot').classList.add('hidden')
      document.getElementById('finalWrap').classList.remove('hidden')

      document.getElementById('pdfBtn').onclick=()=>{
        const opt={margin:0.2,filename:'one-world-one-centre-intake.pdf',image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'in',format:'letter',orientation:'portrait'}}
        html2pdf().set(opt).from(document.getElementById('finalArea')).save()
      }
      document.getElementById('editBtn').onclick=()=>{
        document.getElementById('wizardRoot').classList.remove('hidden')
        document.getElementById('finalWrap').classList.add('hidden')
        window.scrollTo({top:0,behavior:'smooth'})
      }
    }
    window.generateFinal=generateFinal
  </script>
</body>
</html>
