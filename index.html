<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Intake Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .wizard { max-width: 800px; margin: auto; padding: 20px; }
    .step { display: none; }
    .step.active { display: block; }
    .buttons { margin-top: 20px; text-align: center; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; }
    .next { background: #007bff; color: white; }
    .prev { background: #6c757d; color: white; }
    .generate { background: #28a745; color: white; }
    label { display: block; margin: 6px 0; }
    input, select { margin-top: 4px; padding: 6px; width: 95%; }
    .inline { display: inline-block; margin-right: 10px; }
    .disabled { opacity: 0.5; pointer-events: none; }

    /* Final yellow form */
    #output { display: none; margin: 20px auto; max-width: 900px; background: #fffacd; padding: 20px; border: 1px solid #000; }
    #output table { width: 100%; border-collapse: collapse; }
    #output th, #output td { border: 1px solid #000; padding: 6px; vertical-align: top; }
    #output .header-img { width: 100%; max-height: 120px; object-fit: contain; margin-bottom: 10px; }
    #downloadBtn { margin: 15px 0; background: #dc3545; color: white; }
    @media (max-width: 600px) {
      input, select { width: 100%; }
      .inline { display: block; margin-bottom: 10px; }
    }
  </style>
</head>
<body>

<div class="wizard">
  <!-- Step 1 -->
  <div class="step active">
    <h3>Student Details</h3>
    <div id="student-container"></div>
    <button type="button" onclick="addStudent()">âž• Add Student</button>
  </div>

  <!-- Step 2 -->
  <div class="step">
    <h3>School History</h3>
    <label>Previous attendance in Canadian schools?</label>
    <label class="inline"><input type="radio" name="prevAttendance" value="Yes" onchange="togglePrevAttendance()"> Yes</label>
    <label class="inline"><input type="radio" name="prevAttendance" value="No" onchange="togglePrevAttendance()"> No</label>

    <div id="prevDetails">
      <label>Where: <input type="text" id="prevWhere"></label>
      <label>Grade: <input type="text" id="prevGrade"></label>
      <label>For how long: <input type="text" id="prevHowLong"></label>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="step">
    <h3>Immigration Information</h3>
    <label>Immigration Document (of Natural Parent/Guardian)</label>
    <label><input type="checkbox" class="imm-doc" value="PR Card"> PR Card</label>
    <label><input type="checkbox" class="imm-doc" value="Work Permit"> Work Permit</label>
    <label><input type="checkbox" class="imm-doc" value="Study Permit"> Study Permit</label>
    <label><input type="checkbox" class="imm-doc" value="Other" onchange="toggleOther('imm')"> Other <input id="immOther" disabled></label>

    <label>Student's Status</label>
    <label><input type="checkbox" class="stu-status" value="Citizen"> Citizen</label>
    <label><input type="checkbox" class="stu-status" value="PR"> PR</label>
    <label><input type="checkbox" class="stu-status" value="Refugee"> Refugee</label>
    <label><input type="checkbox" class="stu-status" value="Other" onchange="toggleOther('stu')"> Other <input id="stuOther" disabled></label>
  </div>

  <div class="buttons">
    <button type="button" class="prev" onclick="nextPrev(-1)">Back</button>
    <button type="button" class="next" onclick="nextPrev(1)">Next</button>
    <button type="button" class="generate" onclick="generateOutput()">Generate Form</button>
  </div>
</div>

<!-- Final Yellow Form -->
<div id="output">
  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABCoAAACGCAYAAAAbxGtMAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAP+lSURBVHhe7P3nn1zXeeeLftdae1euzjkAjW6gkVMDIAEwZ1KJkpVMBctje3zvOX..." class="header-img" alt="Header">

  <table id="finalTable">
    <!-- Filled dynamically -->
  </table>
  <button id="downloadBtn" onclick="downloadPDF()">Download PDF</button>
</div>

<script>
let currentStep = 0;
showStep(currentStep);

function showStep(n) {
  const steps = document.getElementsByClassName("step");
  for (let i=0; i<steps.length; i++) steps[i].classList.remove("active");
  steps[n].classList.add("active");

  document.querySelector(".prev").style.display = n===0 ? "none" : "inline-block";
  document.querySelector(".next").style.display = n===steps.length-1 ? "none" : "inline-block";
  document.querySelector(".generate").style.display = n===steps.length-1 ? "inline-block" : "none";
}

function nextPrev(n) {
  const steps = document.getElementsByClassName("step");
  currentStep += n;
  if (currentStep >= steps.length) currentStep = steps.length-1;
  if (currentStep < 0) currentStep = 0;
  showStep(currentStep);
}

function addStudent() {
  const container = document.getElementById("student-container");
  const index = container.children.length + 1;
  const div = document.createElement("div");
  div.innerHTML = `
    <h4>Student ${index}</h4>
    <label>First Name: <input type="text" class="firstName"></label>
    <label>Last Name: <input type="text" class="lastName"></label>
    <label>Date of Birth: <input type="date" class="dob"></label>
    <label>Grade: <input type="text" class="grade"></label>
  `;
  container.appendChild(div);
}

function togglePrevAttendance() {
  const yes = document.querySelector('input[name="prevAttendance"][value="Yes"]').checked;
  document.getElementById("prevDetails").className = yes ? "" : "disabled";
}

function toggleOther(type) {
  if (type === 'imm') {
    const otherBox = document.querySelector('input[value="Other"].imm-doc');
    document.getElementById("immOther").disabled = !otherBox.checked;
  } else {
    const otherBox = document.querySelector('input[value="Other"].stu-status');
    document.getElementById("stuOther").disabled = !otherBox.checked;
  }
}

function generateOutput() {
  const students = [...document.querySelectorAll("#student-container > div")].map(s => ({
    first: s.querySelector(".firstName").value,
    last: s.querySelector(".lastName").value,
    dob: s.querySelector(".dob").value,
    grade: s.querySelector(".grade").value
  }));

  const prevAttendance = document.querySelector('input[name="prevAttendance"]:checked')?.value || "";
  const prevWhere = document.getElementById("prevWhere").value;
  const prevGrade = document.getElementById("prevGrade").value;
  const prevHowLong = document.getElementById("prevHowLong").value;

  const immDocs = [...document.querySelectorAll(".imm-doc:checked")].map(c => c.value);
  if (immDocs.includes("Other")) immDocs[immDocs.indexOf("Other")] = "Other: " + document.getElementById("immOther").value;

  const stuStatus = [...document.querySelectorAll(".stu-status:checked")].map(c => c.value);
  if (stuStatus.includes("Other")) stuStatus[stuStatus.indexOf("Other")] = "Other: " + document.getElementById("stuOther").value;

  let html = `
    <tr><th colspan="4">STUDENT INTAKE FORM</th></tr>
    <tr><td colspan="4"><b>STUDENT DETAILS</b></td></tr>
  `;
  students.forEach((s,i) => {
    html += `
      <tr><td>Student ${i+1} First Name</td><td>${s.first}</td><td>Last Name</td><td>${s.last}</td></tr>
      <tr><td>DOB</td><td>${s.dob}</td><td>Grade</td><td>${s.grade}</td></tr>
    `;
  });
  html += `
    <tr><td colspan="4"><b>SCHOOL HISTORY</b></td></tr>
    <tr><td>Prev Attendance</td><td>${prevAttendance}</td><td>Where</td><td>${prevWhere}</td></tr>
    <tr><td>Grade</td><td>${prevGrade}</td><td>How Long</td><td>${prevHowLong}</td></tr>
    <tr><td colspan="4"><b>IMMIGRATION</b></td></tr>
    <tr><td colspan="2">Immigration Docs</td><td colspan="2">${immDocs.join(", ")}</td></tr>
    <tr><td colspan="2">Student Status</td><td colspan="2">${stuStatus.join(", ")}</td></tr>
  `;
  document.getElementById("finalTable").innerHTML = html;
  document.querySelector(".wizard").style.display = "none";
  document.getElementById("output").style.display = "block";
}

function downloadPDF() {
  const element = document.getElementById("output");
  html2pdf().from(element).set({
    margin: 0.2,
    filename: "intake_form.pdf",
    html2canvas: { scale: 2 },
    jsPDF: { unit: "in", format: "letter", orientation: "portrait" }
  }).save();
}

// Initialize with one student
addStudent();
</script>
</body>
</html>
