<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Intake Form</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f9f9f9;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }
    input[type="text"], input[type="date"], select {
      width: 100%;
      padding: 6px;
      margin: 4px 0 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    .student-entry {
      border: 1px dashed #aaa;
      padding: 10px;
      margin-bottom: 10px;
      background: #fff;
    }
    .disabled {
      background: #eee;
      pointer-events: none;
    }
    /* Final yellow form */
    #finalForm {
      display: none;
      background: #fff8d4;
      border: 1px solid #333;
      padding: 10px;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 14px;
    }
    td, th {
      border: 1px solid #333;
      padding: 6px;
      vertical-align: top;
    }
    .section-title {
      background: #ffe680;
      font-weight: bold;
      text-align: center;
    }
    .checkbox {
      font-family: monospace;
    }
    .download-btn {
      margin-top: 15px;
      padding: 8px 15px;
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    .download-btn:hover {
      background: #555;
    }
    @media (max-width: 600px) {
      table, td, th {
        font-size: 12px;
        padding: 4px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Student Intake Wizard</h2>

  <!-- Step 1 -->
  <div class="step active" id="step1">
    <h3>Step 1: Parent/Guardian Info</h3>
    <label>Parent/Guardian Name:</label>
    <input type="text" id="parentName">
    <label>Phone:</label>
    <input type="text" id="parentPhone">
    <label>Email:</label>
    <input type="text" id="parentEmail">
    <div class="buttons">
      <button onclick="nextStep(2)">Next</button>
    </div>
  </div>

  <!-- Step 2 -->
  <div class="step" id="step2">
    <h3>Step 2: Student Info</h3>
    <div id="students"></div>
    <button onclick="addStudent()">Add Student</button>
    <div class="buttons">
      <button onclick="prevStep(1)">Back</button>
      <button onclick="nextStep(3)">Next</button>
    </div>
  </div>

  <!-- Step 3 -->
  <div class="step" id="step3">
    <h3>Step 3: Immigration & Status</h3>
    <label>Immigration Document (Parent/Guardian):</label>
    <div>
      <label><input type="checkbox" name="doc" value="PR Card"> PR Card</label>
      <label><input type="checkbox" name="doc" value="Work Permit"> Work Permit</label>
      <label><input type="checkbox" name="doc" value="Study Permit"> Study Permit</label>
      <label><input type="checkbox" name="doc" value="Other" onchange="toggleOther('doc')"> Other</label>
      <input type="text" id="docOther" style="display:none;" placeholder="Specify">
    </div>
    <label>Student's Status:</label>
    <div>
      <label><input type="checkbox" name="status" value="Citizen"> Citizen</label>
      <label><input type="checkbox" name="status" value="Permanent Resident"> Permanent Resident</label>
      <label><input type="checkbox" name="status" value="Refugee"> Refugee</label>
      <label><input type="checkbox" name="status" value="Other" onchange="toggleOther('status')"> Other</label>
      <input type="text" id="statusOther" style="display:none;" placeholder="Specify">
    </div>
    <div class="buttons">
      <button onclick="prevStep(2)">Back</button>
      <button onclick="generateForm()">Generate Form</button>
    </div>
  </div>

  <!-- Final yellow form -->
  <div id="finalForm">
    <h3>Generated Yellow Form</h3>
    <div id="outputTable"></div>
    <button class="download-btn" onclick="downloadPDF()">Download PDF</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  let currentStep = 1;
  function nextStep(step) {
    document.getElementById("step" + currentStep).classList.remove("active");
    currentStep = step;
    document.getElementById("step" + step).classList.add("active");
  }
  function prevStep(step) {
    document.getElementById("step" + currentStep).classList.remove("active");
    currentStep = step;
    document.getElementById("step" + step).classList.add("active");
  }

  function addStudent() {
    const container = document.getElementById("students");
    const div = document.createElement("div");
    div.className = "student-entry";
    div.innerHTML = `
      <label>Student Name:</label><input type="text" class="studentName">
      <label>DOB:</label><input type="date" class="studentDOB">
      <label>Grade:</label><input type="text" class="studentGrade">
      <label>Previous Attendance in Canadian Schools?</label>
      <select class="studentPrev" onchange="togglePrev(this)">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
      </select>
      <div class="prevDetails disabled">
        <label>Where/Grade/How long:</label>
        <input type="text" class="studentPrevDetails">
      </div>
    `;
    container.appendChild(div);
  }

  function togglePrev(select) {
    const details = select.parentElement.querySelector(".prevDetails");
    if (select.value === "Yes") {
      details.classList.remove("disabled");
    } else {
      details.classList.add("disabled");
      details.querySelector("input").value = "";
    }
  }

  function toggleOther(type) {
    const input = document.getElementById(type + "Other");
    input.style.display = input.style.display === "none" ? "block" : "none";
  }

  function generateForm() {
    document.querySelectorAll(".step").forEach(s => s.classList.remove("active"));
    document.getElementById("finalForm").style.display = "block";

    const parentName = document.getElementById("parentName").value;
    const parentPhone = document.getElementById("parentPhone").value;
    const parentEmail = document.getElementById("parentEmail").value;

    let studentsHTML = "";
    document.querySelectorAll(".student-entry").forEach(stu => {
      const name = stu.querySelector(".studentName").value;
      const dob = stu.querySelector(".studentDOB").value;
      const grade = stu.querySelector(".studentGrade").value;
      const prev = stu.querySelector(".studentPrev").value;
      const prevDetails = stu.querySelector(".studentPrevDetails").value;
      studentsHTML += `
        <tr>
          <td>${name}</td>
          <td>${dob}</td>
          <td>${grade}</td>
          <td>${prev} ${prev === "Yes" ? prevDetails : ""}</td>
        </tr>
      `;
    });

    let docValues = [...document.querySelectorAll('input[name="doc"]:checked')].map(cb => cb.value);
    if (docValues.includes("Other")) {
      docValues[docValues.indexOf("Other")] = "Other: " + document.getElementById("docOther").value;
    }
    let statusValues = [...document.querySelectorAll('input[name="status"]:checked')].map(cb => cb.value);
    if (statusValues.includes("Other")) {
      statusValues[statusValues.indexOf("Other")] = "Other: " + document.getElementById("statusOther").value;
    }

    document.getElementById("outputTable").innerHTML = `
      <table>
        <tr><th colspan="4" class="section-title">PARENT/GUARDIAN INFO</th></tr>
        <tr><td>Name</td><td colspan="3">${parentName}</td></tr>
        <tr><td>Phone</td><td>${parentPhone}</td><td>Email</td><td>${parentEmail}</td></tr>

        <tr><th colspan="4" class="section-title">STUDENT INFO</th></tr>
        <tr><td>Name</td><td>DOB</td><td>Grade</td><td>Previous Attendance</td></tr>
        ${studentsHTML}

        <tr><th colspan="4" class="section-title">IMMIGRATION & STATUS</th></tr>
        <tr><td colspan="2">Immigration Document:</td><td colspan="2">${docValues.join(", ")}</td></tr>
        <tr><td colspan="2">Student Status:</td><td colspan="2">${statusValues.join(", ")}</td></tr>
      </table>
    `;
  }

  function downloadPDF() {
    const element = document.getElementById("outputTable");
    const opt = {
      margin: 0.5,
      filename: "yellow_form.pdf",
      image: { type: "jpeg", quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: "in", format: "letter", orientation: "portrait" }
    };
    html2pdf().set(opt).from(element).save();
  }
</script>
</body>
</html>
