<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>One World One Centre — Intake Wizard & Yellow Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2pdf for one-click PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    /* small helpers */
    .field-gap{gap:12px}
    .disabled-input{background:#f3f4f6;color:#6b7280}
    /* final yellow sheet styling */
    .yellow-bg{background:#FFF9C4}
    .checkbox-box{display:inline-block;width:20px;height:20px;border:1px solid #111;text-align:center;line-height:18px;font-weight:700;margin-right:6px}
    .muted{color:#6b7280}
    @media print{
      body{margin:0}
      .wizard{display:none}
      .final-wrap{display:block}
    }

    /* >>> Additional styles for yellow form layout (boxes, borders, spacing) <<< */
    #finalArea { font-family: Arial, Helvetica, sans-serif; color: #111; }
    #finalArea .yf-table { width:100%; border-collapse: collapse; }
    #finalArea .yf-table td, #finalArea .yf-table th { border:1px solid #222; padding:6px; vertical-align:top; }
    #finalArea .yf-label { font-weight:700; background: transparent; }
    #finalArea .yf-small { font-size:13px; padding:8px; }
    #finalArea .yf-section-title { font-weight:700; padding:8px 6px; border:1px solid #222; text-transform:uppercase; font-size:13px; background:rgba(0,0,0,0.02);}
    #finalArea .yf-student-row td { padding:6px 8px; }
    #finalArea .yf-student-block { display:flex; gap:8px; align-items:flex-start; }
    #finalArea .yf-box { border:1px solid #222; padding:6px; min-height:28px; display:flex; align-items:center; }
    #finalArea .yf-box-inline { display:inline-block; border:1px solid #222; padding:4px 6px; min-width:60px; text-align:center; }
    #finalArea .yf-wide { width:100%; }
    #finalArea .yf-two { width:48%; }
    #finalArea .yf-three { width:32%; }
    #finalArea .yf-right { text-align:right; }
    #finalArea .rev { font-size:11px; margin-top:6px; }
    /* mimic scanned look with slightly heavier borders on major separators */
    #finalArea .major-sep { border-top:3px solid #222; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-6">

    <div id="wizardRoot" class="wizard bg-white rounded-lg shadow p-6">
      <h1 class="text-xl font-semibold mb-4">INFORMATION NEEDED FOR BOOKING APPOINTMENTS — Wizard</h1>

      <!-- PAGE 1 -->
      <section class="page" data-step="1">
        <h2 class="font-medium mb-3">Step 1 — Contact & Intake</h2>
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-2">
            <label class="block text-sm">DATE</label>
            <input id="date" type="date" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-3">
            <label class="block text-sm">TAKEN BY</label>
            <input id="takenBy" type="text" class="w-full border rounded p-2 mt-1" placeholder="Name" />
          </div>
          <div class="col-span-4">
            <label class="block text-sm">CONTACT NAME / SURNAME</label>
            <input id="contactName" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-2">
            <label class="block text-sm">CONTACT PHONE #</label>
            <input id="contactPhone" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-1">
            <label class="block text-sm">RELATION</label>
            <input id="contactRel" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
        </div>

        <div class="flex justify-end mt-4">
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="goTo(2)">Next</button>
        </div>
      </section>

      <!-- PAGE 2 -->
      <section class="page hidden" data-step="2">
        <h2 class="font-medium mb-3">Step 2 — Immigration & Attendance</h2>

        <div class="grid grid-cols-12 gap-3 mb-3">
          <div class="col-span-6">
            <label class="block text-sm">STUDENT'S STATUS</label>
            <div class="mt-1 flex flex-wrap gap-3 items-center">
              <label class="inline-flex items-center"><input type="radio" name="studentStatus" value="PR" class="mr-2">PR</label>
              <label class="inline-flex items-center"><input type="radio" name="studentStatus" value="RC" class="mr-2">RC</label>
              <label class="inline-flex items-center"><input type="radio" name="studentStatus" value="SP" class="mr-2">SP</label>
              <label class="inline-flex items-center"><input type="radio" name="studentStatus" value="WP" class="mr-2">WP</label>
              <label class="inline-flex items-center"><input type="radio" name="studentStatus" value="Other" class="mr-2" onchange="toggleOtherField('studentStatusOther', this)">Other</label>
              <input id="studentStatusOther" type="text" class="hidden border rounded p-2" placeholder="Specify" />
            </div>
          </div>

          <div class="col-span-6">
            <label class="block text-sm">IMMIGRATION DOCUMENT (OF NATURAL PARENT / GUARDIAN)</label>
            <div class="mt-1 flex flex-wrap gap-3 items-center">
              <label class="inline-flex items-center"><input type="radio" name="immDoc" value="PR" class="mr-2">PR</label>
              <label class="inline-flex items-center"><input type="radio" name="immDoc" value="RC" class="mr-2">RC</label>
              <label class="inline-flex items-center"><input type="radio" name="immDoc" value="SP" class="mr-2">SP</label>
              <label class="inline-flex items-center"><input type="radio" name="immDoc" value="WP" class="mr-2">WP</label>
              <label class="inline-flex items-center"><input type="radio" name="immDoc" value="Other" class="mr-2" onchange="toggleOtherField('immDocOther', this)">Other</label>
              <input id="immDocOther" type="text" class="hidden border rounded p-2" placeholder="Specify" />
            </div>
          </div>

          <div class="col-span-4 mt-2">
            <label class="block text-sm">EXPIRY DATE (RC / SP / WP)</label>
            <input id="expiry" type="date" class="w-full border rounded p-2 mt-1" />
          </div>

          <div class="col-span-8 mt-2">
            <label class="block text-sm">PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?</label>
            <div class="mt-1 flex items-center gap-6">
              <label class="inline-flex items-center"><input type="radio" name="prevAttend" value="No" onchange="toggleAttendance(false)" class="mr-2">No</label>
              <label class="inline-flex items-center"><input type="radio" name="prevAttend" value="Yes" onchange="toggleAttendance(true)" class="mr-2">Yes</label>
            </div>
            <input id="prevDetails" type="text" class="mt-2 w-full border rounded p-2 disabled-input" placeholder="If Yes: Where / Grade / For how long" disabled />
          </div>

          <div class="col-span-12 mt-2">
            <label class="block text-sm">DATE STUDENT(S) LANDED IN CANADA</label>
            <input id="landed" type="date" class="w-full border rounded p-2 mt-1" />
          </div>
        </div>

        <div class="flex justify-between">
          <button class="px-4 py-2 bg-gray-500 text-white rounded" onclick="goTo(1)">Back</button>
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="goTo(3)">Next</button>
        </div>
      </section>

      <!-- PAGE 3 Parents -->
      <section class="page hidden" data-step="3">
        <h2 class="font-medium mb-3">Step 3 — Parent / Guardian</h2>
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-3">
            <label class="block text-sm">FATHER'S SURNAME</label>
            <input id="fatherSurname" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-3">
            <label class="block text-sm">FATHER'S GIVEN NAME</label>
            <input id="fatherGiven" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-3">
            <label class="block text-sm">MOTHER'S SURNAME</label>
            <input id="motherSurname" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-3">
            <label class="block text-sm">MOTHER'S GIVEN NAME</label>
            <input id="motherGiven" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
        </div>
        <div class="flex justify-between mt-4">
          <button class="px-4 py-2 bg-gray-500 text-white rounded" onclick="goTo(2)">Back</button>
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="goTo(4)">Next</button>
        </div>
      </section>

      <!-- PAGE 4 Address & family -->
      <section class="page hidden" data-step="4">
        <h2 class="font-medium mb-3">Step 4 — Address & Family</h2>
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-2">
            <label class="block text-sm">APARTMENT #</label>
            <input id="apt" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-8">
            <label class="block text-sm">FAMILY ADDRESS</label>
            <input id="address" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-2">
            <label class="block text-sm">POSTAL CODE</label>
            <input id="postal" type="text" class="w-full border rounded p-2 mt-1" />
          </div>

          <div class="col-span-4 mt-2">
            <label class="block text-sm">FAMILY PHONE #</label>
            <input id="familyPhone" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-4 mt-2">
            <label class="block text-sm">HOME LANGUAGE</label>
            <input id="homeLang" type="text" class="w-full border rounded p-2 mt-1" />
          </div>
          <div class="col-span-4 mt-2">
            <label class="block text-sm">CATHOLIC</label>
            <div class="mt-1 flex items-center gap-6">
              <label class="inline-flex items-center"><input type="radio" name="catholic" value="No" class="mr-2">No</label>
              <label class="inline-flex items-center"><input type="radio" name="catholic" value="Yes" class="mr-2">Yes</label>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <button class="px-4 py-2 bg-gray-500 text-white rounded" onclick="goTo(3)">Back</button>
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="goTo(5)">Next</button>
        </div>
      </section>

      <!-- PAGE 5 Students (dynamic add) -->
      <section class="page hidden" data-step="5">
        <h2 class="font-medium mb-3">Step 5 — Student Details (Add as many as needed)</h2>
        <div id="studentsContainer" class="space-y-4">
          <!-- template inserted by JS -->
        </div>
        <div class="flex items-center gap-3 mt-3">
          <button class="px-3 py-2 bg-blue-600 text-white rounded" onclick="addStudent()" type="button">Add Student</button>
          <button class="px-3 py-2 bg-red-500 text-white rounded" onclick="removeStudent()" type="button">Remove Last</button>
        </div>

        <div class="flex justify-between mt-4">
          <button class="px-4 py-2 bg-gray-500 text-white rounded" onclick="goTo(4)">Back</button>
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="goTo(6)">Next</button>
        </div>
      </section>

      <!-- PAGE 6 Schooling profile & notes -->
      <section class="page hidden" data-step="6">
        <h2 class="font-medium mb-3">Step 6 — Schooling Profile & Notes</h2>
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-4">
            <label class="block text-sm">POTENTIAL LIMITED FORMAL SCHOOLING PROFILE</label>
            <div class="mt-1 flex items-center gap-6">
              <label class="inline-flex items-center"><input type="radio" name="limitedProfile" value="No">No</label>
              <label class="inline-flex items-center"><input type="radio" name="limitedProfile" value="Yes">Yes</label>
            </div>
          </div>
          <div class="col-span-8">
            <label class="block text-sm">DETAILS (Number of years as refugees, country of relocation, refugee camp name, nature of schooling, parent country of origin)</label>
            <textarea id="notes" class="w-full border rounded p-2 mt-1" placeholder="Describe if relevant"></textarea>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <button class="px-4 py-2 bg-gray-500 text-white rounded" onclick="goTo(5)">Back</button>
          <button class="px-4 py-2 bg-green-700 text-white rounded" onclick="generateFinal()">Generate Yellow Form</button>
        </div>
      </section>

    </div>

    <!-- FINAL STATIC YELLOW FORM -->
    <div id="finalWrap" class="final-wrap hidden mt-6">
      <div id="finalArea" class="yellow-bg p-6 rounded shadow border">
        <!-- content injected here -->
      </div>

      <div class="mt-4 flex gap-3">
        <button id="printBtn" class="px-4 py-2 bg-blue-600 text-white rounded" onclick="window.print()">Print</button>
        <button id="pdfBtn" class="px-4 py-2 bg-indigo-600 text-white rounded">Download PDF</button>
        <button id="editBtn" class="px-4 py-2 bg-gray-500 text-white rounded">Back to Edit</button>
      </div>
    </div>

  </div>

  <script>
    // --- Wizard navigation ---
    function goTo(step){
      document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'))
      const target = document.querySelector(`.page[data-step='${step}']`)
      if(target) target.classList.remove('hidden')
      window.scrollTo({top:0,behavior:'smooth'})
    }

    // --- toggle Other text fields for radio groups ---
    function toggleOtherField(id, el){
      const inp = document.getElementById(id)
      if(el.value === 'Other' && el.checked){ inp.classList.remove('hidden'); inp.focus() } else { inp.classList.add('hidden'); inp.value = '' }
    }

    // --- Attendance enabling/disabling ---
    function toggleAttendance(isYes){
      const d = document.getElementById('prevDetails')
      if(isYes){ d.disabled = false; d.classList.remove('disabled-input') } else { d.disabled = true; d.classList.add('disabled-input'); d.value = '' }
    }

    // --- Dynamic students ---
    let studentCount = 0
    function addStudent(prefill){
      studentCount++
      const id = studentCount
      const container = document.getElementById('studentsContainer')
      const wrap = document.createElement('div')
      wrap.className = 'p-4 border rounded bg-gray-50'
      wrap.id = `student-${id}`
      wrap.innerHTML = `
        <div class="grid grid-cols-12 gap-3">
          <div class="col-span-3">
            <label class="text-sm">STUDENT'S SURNAME</label>
            <input type="text" id="s_${id}_surname" class="w-full border rounded p-2 mt-1" value="${prefill?.surname||''}" />
          </div>
          <div class="col-span-3">
            <label class="text-sm">STUDENT'S GIVEN NAME</label>
            <input type="text" id="s_${id}_given" class="w-full border rounded p-2 mt-1" value="${prefill?.given||''}" />
          </div>
          <div class="col-span-2">
            <label class="text-sm">GENDER</label>
            <div class="mt-1 flex items-center gap-3">
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_gender" value="F" class="mr-2">F</label>
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_gender" value="M" class="mr-2">M</label>
            </div>
          </div>
          <div class="col-span-2">
            <label class="text-sm">DOB</label>
            <input type="date" id="s_${id}_dob" class="w-full border rounded p-2 mt-1" value="${prefill?.dob||''}" />
          </div>
          <div class="col-span-2">
            <label class="text-sm">BIRTH COUNTRY</label>
            <input type="text" id="s_${id}_birth" class="w-full border rounded p-2 mt-1" value="${prefill?.birth||''}" />
          </div>

          <div class="col-span-4 mt-2">
            <label class="text-sm">LAST GRADE COMPLETED</label>
            <input type="text" id="s_${id}_lastgrade" class="w-full border rounded p-2 mt-1" value="${prefill?.lastgrade||''}" />
          </div>
          <div class="col-span-4 mt-2">
            <label class="text-sm">SCHOOL YEAR</label>
            <div class="mt-1 flex items-center gap-3">
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_year" value="ThisYear" class="mr-2">This year</label>
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_year" value="NextYear" class="mr-2">Next year</label>
            </div>
          </div>
          <div class="col-span-4 mt-2">
            <label class="text-sm">PROGRAM</label>
            <div class="mt-1 flex items-center gap-3">
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_prog" value="No" class="mr-2">No</label>
              <label class="inline-flex items-center"><input type="radio" name="s_${id}_prog" value="Yes" class="mr-2">Yes</label>
              <input type="text" id="s_${id}_prog_spec" class="border rounded p-2 ml-2" placeholder="Specify (if Yes)" />
            </div>
          </div>
        </div>
      `
      container.appendChild(wrap)
      window.scrollTo({top:wrap.offsetTop-60, behavior:'smooth'})
    }
    function removeStudent(){ if(studentCount===0) return; const el=document.getElementById(`student-${studentCount}`); if(el) el.remove(); studentCount-- }

    // start with 1 student by default
    addStudent()

    // --- Build final static yellow form ---
    function checkboxMark(cond){ return cond ? '☑' : '☐' }

    function getRadioValue(name){ const r=document.querySelector(`input[name='${name}']:checked`); return r? r.value : '' }

    function generateFinal(){
      const final = document.getElementById('finalArea')
      final.innerHTML = ''

      // gather data
      const data = {
        date: document.getElementById('date').value || '',
        takenBy: document.getElementById('takenBy').value || '',
        contactName: document.getElementById('contactName').value || '',
        contactPhone: document.getElementById('contactPhone').value || '',
        contactRel: document.getElementById('contactRel').value || '',
        sStatus: (function(){ const v=getRadioValue('studentStatus'); return v==='Other'? document.getElementById('studentStatusOther').value : v || '' })(),
        immDoc: (function(){ const v=getRadioValue('immDoc'); return v==='Other'? document.getElementById('immDocOther').value : v || '' })(),
        expiry: document.getElementById('expiry').value || '',
        prevAttend: getRadioValue('prevAttend') || '',
        prevDetails: document.getElementById('prevDetails').value || '',
        landed: document.getElementById('landed').value || '',
        fatherSurname: document.getElementById('fatherSurname').value || '',
        fatherGiven: document.getElementById('fatherGiven').value || '',
        motherSurname: document.getElementById('motherSurname').value || '',
        motherGiven: document.getElementById('motherGiven').value || '',
        apt: document.getElementById('apt').value || '',
        address: document.getElementById('address').value || '',
        postal: document.getElementById('postal').value || '',
        familyPhone: document.getElementById('familyPhone').value || '',
        homeLang: document.getElementById('homeLang').value || '',
        catholic: getRadioValue('catholic') || '',
        limitedProfile: getRadioValue('limitedProfile') || '',
        notes: document.getElementById('notes').value || ''
      };

      // build HTML template that mimics the scanned yellow sheet
      let html = `
        <div style="width:100%;">
          <h2 style="text-align:center; margin:0 0 8px 0; font-size:16px; font-weight:700;">INFORMATION NEEDED FOR BOOKING APPOINTMENTS</h2>

          <!-- Top grid -->
          <table class="yf-table" style="margin-top:8px;">
            <tr>
              <td class="yf-label" style="width:12%;">DATE</td>
              <td class="yf-small" style="width:22%;">${data.date}</td>
              <td class="yf-label" style="width:12%;">TAKEN BY</td>
              <td class="yf-small" style="width:54%;">${data.takenBy}</td>
            </tr>
            <tr>
              <td class="yf-label">CONTACT NAME/SURNAME</td>
              <td class="yf-small">${data.contactName}</td>
              <td class="yf-label">CONTACT PHONE #</td>
              <td class="yf-small">${data.contactPhone}</td>
            </tr>
            <tr>
              <td class="yf-label">CONTACT RELATIONSHIP</td>
              <td class="yf-small">${data.contactRel}</td>
              <td class="yf-label">STUDENT'S STATUS</td>
              <td class="yf-small">${data.sStatus}</td>
            </tr>
            <tr>
              <td class="yf-label">IMMIGRATION DOCUMENT (OF NATURAL PARENT/GUARDIAN)</td>
              <td class="yf-small">${data.immDoc}</td>
              <td class="yf-label">EXPIRY DATE (RC/SP/WP)</td>
              <td class="yf-small">${data.expiry}</td>
            </tr>
            <tr>
              <td class="yf-label">PREVIOUS ATTENDANCE IN CANADIAN SCHOOLS?</td>
              <td class="yf-small">${data.prevAttend ? (checkboxMark(data.prevAttend==='Yes') + ' Yes   ' + checkboxMark(data.prevAttend==='No') + ' No') : ''}</td>
              <td class="yf-label">DATE STUDENT(S) LANDED IN CANADA</td>
              <td class="yf-small">${data.landed}</td>
            </tr>
            <tr>
              <td class="yf-label">PREVIOUS DETAILS</td>
              <td class="yf-small" colspan="3">${data.prevDetails || (data.prevAttend ? '' : '—')}</td>
            </tr>
          </table>

          <!-- Parents -->
          <table class="yf-table" style="margin-top:8px;">
            <tr>
              <td class="yf-label" style="width:25%;">FATHER'S SURNAME</td>
              <td class="yf-small" style="width:25%;">${data.fatherSurname}</td>
              <td class="yf-label" style="width:25%;">FATHER'S GIVEN NAME</td>
              <td class="yf-small" style="width:25%;">${data.fatherGiven}</td>
            </tr>
            <tr>
              <td class="yf-label">MOTHER'S SURNAME</td>
              <td class="yf-small">${data.motherSurname}</td>
              <td class="yf-label">MOTHER'S GIVEN NAME</td>
              <td class="yf-small">${data.motherGiven}</td>
            </tr>
          </table>

          <!-- Address & family -->
          <table class="yf-table" style="margin-top:8px;">
            <tr>
              <td class="yf-label" style="width:16%;">APARTMENT #</td>
              <td class="yf-small" style="width:34%;">${data.apt}</td>
              <td class="yf-label" style="width:16%;">FAMILY ADDRESS</td>
              <td class="yf-small" style="width:34%;">${data.address}${data.postal? ' / ' + data.postal: ''}</td>
            </tr>
            <tr>
              <td class="yf-label">FAMILY PHONE #</td>
              <td class="yf-small">${data.familyPhone}</td>
              <td class="yf-label">HOME LANGUAGE</td>
              <td class="yf-small">${data.homeLang}</td>
            </tr>
            <tr>
              <td class="yf-label">CATHOLIC</td>
              <td class="yf-small" colspan="3">${data.catholic ? (checkboxMark(data.catholic==='Yes') + ' Yes   ' + checkboxMark(data.catholic==='No') + ' No') : ''}</td>
            </tr>
          </table>

          <!-- Students header -->
          <div style="margin-top:10px; font-weight:700; border:1px solid #222; padding:6px;">STUDENT(S)</div>
          <table class="yf-table" style="margin-top:6px;">
            <thead>
              <tr>
                <th style="width:18%;">STUDENT'S SURNAME</th>
                <th style="width:18%;">STUDENT'S GIVEN NAME</th>
                <th style="width:8%;">GENDER</th>
                <th style="width:12%;">DOB</th>
                <th style="width:14%;">BIRTH COUNTRY</th>
                <th style="width:10%;">LAST GRADE COMPLETED</th>
                <th style="width:10%;">SCHOOL YEAR</th>
                <th style="width:10%;">PROGRAM</th>
              </tr>
            </thead>
            <tbody>
      `;

      // add each student as a block row (one student per row)
      for(let i=1;i<=studentCount;i++){
        const surname = document.getElementById(`s_${i}_surname`)?.value || ''
        const given = document.getElementById(`s_${i}_given`)?.value || ''
        const gender = (function(){ const g = document.querySelector(`input[name='s_${i}_gender']:checked`); return g? g.value : '' })()
        const dob = document.getElementById(`s_${i}_dob`)?.value || ''
        const birth = document.getElementById(`s_${i}_birth`)?.value || ''
        const last = document.getElementById(`s_${i}_lastgrade`)?.value || ''
        const year = (function(){ const y = document.querySelector(`input[name='s_${i}_year']:checked`); return y? (y.value==='ThisYear'?'This year':'Next year') : '' })()
        const prog = (function(){ const p = document.querySelector(`input[name='s_${i}_prog']:checked`); return p? p.value : '' })()
        const progSpec = document.getElementById(`s_${i}_prog_spec`)?.value || ''

        // if there's little or no data for this student, still create an empty row so printed form has space
        html += `
          <tr class="yf-student-row">
            <td class="yf-small">${surname}</td>
            <td class="yf-small">${given}</td>
            <td class="yf-small">${checkboxMark(gender==='F')} F&nbsp;&nbsp; ${checkboxMark(gender==='M')} M</td>
            <td class="yf-small">${dob}</td>
            <td class="yf-small">${birth}</td>
            <td class="yf-small">${last}</td>
            <td class="yf-small">${year}</td>
            <td class="yf-small">${prog}${progSpec? ' — ' + progSpec : ''}</td>
          </tr>
        `;
      }

      // include extra blank rows to ensure printable space (makes it resemble the scan)
      const extraRows = Math.max(0, 4 - studentCount);
      for(let r=0;r<extraRows;r++){
        html += `
          <tr class="yf-student-row">
            <td class="yf-small">&nbsp;</td><td class="yf-small">&nbsp;</td><td class="yf-small">&nbsp;</td>
            <td class="yf-small">&nbsp;</td><td class="yf-small">&nbsp;</td><td class="yf-small">&nbsp;</td>
            <td class="yf-small">&nbsp;</td><td class="yf-small">&nbsp;</td>
          </tr>
        `;
      }

      html += `
            </tbody>
          </table>

          <!-- Limited schooling + notes -->
          <table class="yf-table" style="margin-top:10px;">
            <tr>
              <td class="yf-label" style="width:35%;">POTENTIAL LIMITED FORMAL SCHOOLING PROFILE</td>
              <td class="yf-small" style="width:65%;">${data.limitedProfile ? (checkboxMark(data.limitedProfile==='Yes') + ' Yes   ' + checkboxMark(data.limitedProfile==='No') + ' No') : ''}</td>
            </tr>
            <tr>
              <td class="yf-label">NOTES</td>
              <td class="yf-small">${data.notes}</td>
            </tr>
          </table>

          <div class="rev">Rev. 2021</div>
        </div>
      `;

      final.innerHTML = html;

      // show final area and hide wizard
      document.getElementById('wizardRoot').classList.add('hidden')
      document.getElementById('finalWrap').classList.remove('hidden')
      window.scrollTo({top:0,behavior:'smooth'})

      // pdf button logic (kept as before)
      document.getElementById('pdfBtn').onclick = ()=>{
        const opt = { margin:0.2, filename:'one-world-one-centre-intake.pdf', image:{type:'jpeg',quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'in',format:'letter',orientation:'portrait'} }
        html2pdf().set(opt).from(document.getElementById('finalArea')).save()
      }

      document.getElementById('editBtn').onclick = ()=>{
        document.getElementById('wizardRoot').classList.remove('hidden')
        document.getElementById('finalWrap').classList.add('hidden')
        window.scrollTo({top:0,behavior:'smooth'})
      }
    }

    // Expose generate function for button
    window.generateFinal = generateFinal

  </script>
</body>
</html>
